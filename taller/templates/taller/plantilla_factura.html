{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Factura #{{ factura.id }}</title>
    <style>
        @page { size: a4 portrait; margin: 1.5cm; }
        body { font-family: sans-serif; font-size: 11px; }
        
        /* --- ESTRUCTURA DE CABECERA DEFINITIVA CON POSICIONAMIENTO ABSOLUTO --- */
        .header-container {
            position: relative; /* Contenedor de referencia */
            height: 140px; /* Altura fija para la cabecera */
            border-bottom: 2px solid #f2f2f2;
            margin-bottom: 20px;
        }
        
        .logo-container {
            position: absolute; /* Posicionamiento absoluto */
            left: 0;
            top: 45px; /* Distancia desde la parte superior */
        }
        
        .logo-container img { 
            height: 90px; /* Tamaño del logo */
        }
        
        .info-factura { 
            text-align: right; 
        }
        
        .cliente-info { border: 1px solid #ccc; padding: 15px; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .totales { margin-top: 20px; text-align: right; width: 250px; margin-left: auto; }
        .totales p { margin: 5px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-container">
            <div class="logo-container">
                <img src="{% static 'taller/images/logo.jpg' %}">
            </div>
            <div class="info-factura">
                <h2>Factura</h2>
                <p><strong>Número:</strong> {{ factura.id }}<br><strong>Fecha:</strong> {{ factura.fecha_emision|date:"d/m/Y" }}</p>
                <p>
                    <strong>Taller ServiMax</strong><br>
                    Polígono de Constantí<br>
                    43120 Constantí, Tarragona
                </p>
            </div>
        </div>

        <div class="cliente-info">
            <h3>Datos del Cliente</h3>
            <p>
                <strong>Nombre:</strong> {{ cliente.nombre }}<br>
                **Teléfono:** {{ cliente.telefono }}<br>
                **Vehículo:** {{ vehiculo.marca }} {{ vehiculo.modelo }} - {{ vehiculo.matricula }}
            </p>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Descripción</th>
                    <th style="text-align: right; width: 80px;">Cantidad</th>
                    <th style="text-align: right; width: 100px;">Precio Unit.</th>
                    <th style="text-align: right; width: 100px;">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for linea in lineas %}
                <tr>
                    <td>{{ linea.descripcion }}</td>
                    <td style="text-align: right;">{{ linea.cantidad|floatformat:2 }}</td>
                    <td style="text-align: right;">{{ linea.precio_unitario|floatformat:2 }} €</td>
                    <td style="text-align: right;">{{ linea.total_linea|floatformat:2 }} €</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="totales">
            <p><strong>Subtotal:</strong> {{ factura.subtotal|floatformat:2 }} €</p>
            <p><strong>IVA (21%):</strong> {{ factura.iva|floatformat:2 }} €</p>
            <hr>
            <h3 style="margin-bottom: 5px;"><strong>TOTAL FACTURA:</strong> {{ factura.total_final|floatformat:2 }} €</h3>
            <p><strong>Pagado a cuenta (Abonos):</strong> -{{ abonos|floatformat:2 }} €</p>
            <h3 style="margin-top: 5px;"><strong style="color: #dc3545;">PENDIENTE DE PAGO:</strong> {{ pendiente|floatformat:2 }} €</h3>
        </div>
    </div>
</body>
</html>