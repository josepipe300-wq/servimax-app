<!DOCTYPE html>
{% load static %}
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% if factura.es_factura %}Factura N¬∫ {{ factura.numero_factura }}{% else %}Recibo N¬∫ {{ factura.id }}{% endif %}</title>
    <style>
        /* ==============================================================
           ESTILOS INCRUSTADOS PARA GARANTIZAR COMPATIBILIDAD CON PDF
           ============================================================== */
        @page { size: A4 portrait; margin: 1.2cm; }
        
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            color: #334155;
            margin: 0;
            padding: 0;
            font-size: 12px;
            background-color: #ffffff;
        }

        table { width: 100%; border-collapse: collapse; }
        
        /* 1. CABECERA */
        .header { margin-bottom: 30px; border-bottom: 2px solid #f1f5f9; padding-bottom: 20px; }
        .header td { vertical-align: top; }
        .invoice-title { font-size: 28px; font-weight: 900; color: #0f172a; margin: 0 0 5px 0; text-transform: uppercase; letter-spacing: -0.03em; }
        .company-name { margin: 0 0 5px 0; color: #1e40af; font-size: 20px; font-weight: 800; text-transform: uppercase; }
        .company-details { color: #475569; font-size: 11px; line-height: 1.5; }

        /* 2. SECCI√ìN CLIENTE Y VEH√çCULO */
        .info-table { margin-bottom: 30px; }
        .info-table td { vertical-align: top; width: 50%; line-height: 1.6; padding: 15px; border: 1px solid #e2e8f0; border-radius: 8px; }
        .section-title { font-size: 10px; font-weight: 800; color: #64748b; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; border-bottom: 1px solid #e2e8f0; padding-bottom: 4px; }
        .matricula-badge { background: #f1f5f9; padding: 2px 6px; border-radius: 4px; font-weight: 800; border: 1px solid #cbd5e1; color: #0f172a; font-size: 1.1em;}

        /* 3. TABLA DE CONCEPTOS */
        .items-table { margin-bottom: 25px; }
        .items-table th { background-color: #f8fafc; color: #64748b; font-weight: 700; text-align: left; padding: 10px 12px; border: 1px solid #e2e8f0; border-bottom: 2px solid #cbd5e1; text-transform: uppercase; font-size: 10px; letter-spacing: 0.05em; }
        .items-table td { padding: 12px; border: 1px solid #e2e8f0; color: #0f172a; vertical-align: middle; }
        .items-table .money { text-align: right; font-weight: 600; width: 15%; }
        .items-table .cant-col { text-align: right; width: 10%; }
        .items-table .desc-col { font-weight: 500; }

        /* 4. TOTALES */
        .totals-wrapper { width: 100%; margin-top: 10px; page-break-inside: avoid; }
        .totals-table { width: 45%; float: right; border-collapse: collapse; }
        .totals-table td { padding: 8px 12px; text-align: right; border-bottom: 1px solid #f1f5f9; }
        .totals-table .label { font-weight: 600; color: #64748b; text-align: left; }
        .totals-table .grand-total td { font-size: 16px; font-weight: 900; color: #0f172a; border-top: 2px solid #cbd5e1; padding-top: 12px; }
        
        .abonos-row td { color: #64748b; }
        .pendiente-row td { color: #dc2626; font-size: 16px; font-weight: 900; border-top: 2px solid #fecaca; background-color: #fef2f2; padding-top: 12px; padding-bottom: 12px;}

        /* 5. NOTAS */
        .notes-box { width: 50%; float: left; background: #f8fafc; padding: 15px; border-radius: 6px; border-left: 4px solid #3b82f6; page-break-inside: avoid; }
        .clear { clear: both; }

        .footer { text-align: center; color: #94a3b8; font-size: 10px; margin-top: 40px; border-top: 1px solid #f1f5f9; padding-top: 15px; }
    </style>
</head>
<body>

    <table class="header">
        <tr>
            <td style="width: 50%;">
                <div class="invoice-title">
                    {% if factura.es_factura %}FACTURA{% else %}RECIBO{% endif %}
                </div>
                <div style="color: #64748b; font-size: 12px; margin-top: 8px; font-weight: 500; line-height: 1.6;">
                    <strong>N¬∫ Documento:</strong> <span style="color: #0f172a;">{% if factura.es_factura %}{{ factura.numero_factura }}{% else %}{{ factura.id }}{% endif %}</span><br>
                    <strong>Fecha de emisi√≥n:</strong> <span style="color: #0f172a;">{{ factura.fecha_emision|date:"d/m/Y" }}</span>
                </div>
            </td>
            <td style="width: 50%; text-align: right;">
                <h2 class="company-name">Taller ServiMax</h2>
                <div class="company-details">
                    <em>Honestidad y Calidad</em><br>
                    {% if factura.es_factura %}
                    <strong>JOSE EVARDID MENDIETA CORTES</strong><br>
                    NIE: Y9305858A<br>
                    Carrer del Terrer 18<br>
                    43840 Salou, Tarragona<br>
                    {% endif %}
                    <strong>Tel√©fono:</strong> 642 99 30 63
                </div>
            </td>
        </tr>
    </table>

    <table class="info-table">
        <tr>
            <td style="border-right: 5px solid #ffffff;">
                <div class="section-title">üë§ Datos del Cliente</div>
                <strong style="font-size: 14px; color: #0f172a; display: block; margin-bottom: 5px;">{{ cliente.nombre|title }}</strong>
                <span style="color: #475569;">Tel√©fono:</span> {{ cliente.telefono }}<br>
                
                {% if factura.es_factura %}
                    <span style="color: #475569;">{{ cliente.get_tipo_documento_display|default:'DNI' }}:</span> {{ cliente.documento_fiscal|default:'---' }}<br>
                    <span style="color: #475569;">Direcci√≥n:</span> {{ cliente.direccion_fiscal|default:'---' }}<br>
                    {{ cliente.codigo_postal_fiscal|default:'' }} {{ cliente.ciudad_fiscal|default:'' }} ({{ cliente.provincia_fiscal|default:'TARRAGONA' }})
                {% endif %}
            </td>
            <td style="border-left: 5px solid #ffffff;">
                <div class="section-title">üöó Datos del Veh√≠culo</div>
                <strong style="font-size: 14px; color: #0f172a; display: block; margin-bottom: 5px;">{{ vehiculo.marca }} {{ vehiculo.modelo }}</strong>
                <span style="color: #475569;">Matr√≠cula:</span> <span class="matricula-badge">{{ vehiculo.matricula }}</span><br>
                <span style="color: #475569;">Kilometraje:</span> {{ vehiculo.kilometraje }} km
            </td>
        </tr>
    </table>

    <table class="items-table">
        <thead>
            <tr>
                <th>Descripci√≥n</th>
                <th class="cant-col">Cantidad</th>
                <th class="money">Precio Unit.</th>
                <th class="money">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for linea in lineas %}
            <tr>
                <td class="desc-col">{{ linea.descripcion }}</td>
                <td class="cant-col">{{ linea.cantidad|floatformat:2 }}</td>
                <td class="money">{{ linea.precio_unitario|floatformat:2 }} ‚Ç¨</td>
                <td class="money" style="font-weight: 700;">{{ linea.total_linea|floatformat:2 }} ‚Ç¨</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" style="text-align:center; color:#94a3b8; font-style: italic; padding: 20px;">
                    Sin conceptos registrados.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="totals-wrapper">
        
        {% if factura.notas_cliente %}
        <div class="notes-box">
            <strong style="color: #1e40af; font-size: 11px; text-transform: uppercase;">Notas Adicionales:</strong><br>
            <span style="color: #334155; font-size: 11px; white-space: pre-wrap;">{{ factura.notas_cliente }}</span>
        </div>
        {% endif %}

        <table class="totals-table">
            {% if factura.es_factura %}
                <tr>
                    <td class="label">Subtotal:</td>
                    <td>{{ factura.subtotal|floatformat:2 }} ‚Ç¨</td>
                </tr>
                <tr>
                    <td class="label">IVA (21%):</td>
                    <td>{{ factura.iva|floatformat:2 }} ‚Ç¨</td>
                </tr>
            {% endif %}
            
            <tr class="grand-total">
                <td class="label">TOTAL {% if factura.es_factura %}FACTURA{% else %}RECIBO{% endif %}:</td>
                <td>{{ factura.total_final|floatformat:2 }} ‚Ç¨</td>
            </tr>
            
            <tr class="abonos-row">
                <td class="label">Pagado a cuenta (Abonos):</td>
                <td>- {{ abonos|floatformat:2 }} ‚Ç¨</td>
            </tr>
            
            <tr class="pendiente-row">
                <td class="label">PENDIENTE DE PAGO:</td>
                <td>{{ pendiente|floatformat:2 }} ‚Ç¨</td>
            </tr>
        </table>
        
        <div class="clear"></div>
    </div>

    <div class="footer">
        <strong>Gracias por confiar en ServiMax Taller.</strong><br>
       Documento emitido el {{ factura.fecha_emision|date:"d/m/Y" }}
    </div>
    
</body>
</html>